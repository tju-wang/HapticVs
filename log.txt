2019.3      Haptic @MrWang_tju

* mean will do
//*mean have done
** mean problem to solve
//**mean problem have solved

4.23
0.将程序中使用的指针  替换为数组  避免使用 malloc函数  避免使用free函数
**a. 求逆矩阵时  只要输出 printf inv.data[] 的内容  计算结果就正确  否则错误！！ 不知道为什么  不调用 结果不对
--》尝试将 Matrix_t 中的double 申明为 volatile 类型  但是有更奇怪的现象


4.18
//**a. 静平台参数 b  可能不准  --》修正为 75
0.修正参数  修正杆长为362.5mm  加了R副与P副连接件的长度  修正P副质量
1.加大末端重量参数

**b. 在加上滑动摩擦补偿后  点头现象加重

4.16
*a.修正重力补偿  质点 及 质量分布   调参数
1.末端应该加重  在z变大 补偿的力不足    验证4个质量  对F1-3的影响因素

*b.单片机跑最新运动学算法   --》力要做限制  接收到的  或计算得出的  有通讯导致的小卡顿，没收到数据或数据不对

//**c.串口接收数据  跑着跑着卡死   协议中添加Error显示位  -->完成
*d.三维力传感器
**e. 重力补偿  1杆有明显的点头！！  原因待查


0.增加 发送  接收缓存区清除函数
1.添加错误输出函数  修改串口接收部分程序

4.15
0.排查4.11  问题a
1.完成 4.13 a.
2.4.13  b. windows下限制程序运行时间  需要新开线程。。不会   Linux下可以用alarm()函数
3.完成 4.13  c.


4.13
0.与下位机双向数据传输完成   添加数据发送部分
1.修改上一次记过计算结果为本次迭代初值  迭代次数变为1-2次

//*a.将串口校验相关整理到uart.c文件中  整理代码格式  缕清思路 -->完成
*b.在q1 q2 q3 给值不合理时  会导致正解求解出错  程序卡死  计算前加数据检验 或 添加窗口看门狗  -->没实现设置alarm()
//*c.在求解正解前   对得出的p副长度数据进行验算  否则还有可能导致程序卡死！！ -->在杆长限定范围内 不会出现运动学卡死的状况

//**在ctrl+c停止程序  再运行会导致收不到数据  暂不知道卡在那   
卡在初始化串口之前  很奇怪！ 调用InitSerialPort没反应  在InitSerialPort中输出printf 无输出  卡死
-->shitt!!  文件夹中包含了两个seriallib.c文件！ 导致的奇怪问题
解决问题：在未收到协议尾时,在接收协议数量够的情况下  置RxFinish=1 此时退出接收  但数据错误
1.未校验数据就进行使用  
2.数据错误导致机构正解求解失败



//**python  haptic.py  在先打开一个插入电脑的串口时  会无法打开其他串口
-->Google一下你就知道！

4.11
0.求解C点坐标  将Zi替换为Xi  排除求解过程分母为0的问题
1.之前在计算C点坐标时，没有将q1 q2 q3作为变量处理！！  导致只有试验当次的数据可以符合求解条件
也可以解释之前的电脑求解  换初始数据之后，导致结果与matlab不同的情况


//a.**C1点验证   存在0.1量级偏差  但是C2  C3没有   检查公式细节
-->公式有问题    1. MATLAB 输出  cos(beta)^2  含义是 pow(cos(beta),2)  只有求解C1点的过程中存在这一项  ca  cb中有
                -->python 字符替换导致的问题
                2.vA1C1  之前的欧拉角与现在欧拉角需要替换公式   sin  cos 有些项是反的
 

4.9
0.修改雅克比求解公式  修改欧拉角定义  排除正解卡死问题  -->解决
//**在X0 Y0接近0附近  存在 Zi=0的情况  导致的过原点力的计算值有突变   也可能是其他原因
-->原因： matlab符号计算中引入了q1 q2 q3等数值，导致公式在变换位置时计算失败

4.8
0.测试 移植uart相关代码
1.联通单片机  测试求解效果
    X 或 Y坐标点  有一个接近0 的时候，正解出问题

4.6
1.修正B点坐标
2.修改求解C点时  错误使用q1 的bug  正确求解C点坐标
3.修复了求解FB_x力的错误

3.28
1.求解C点坐标  Zi 在动平台角度较小时  Zi = 0  此时无法保证除数非0   
此时需要求解Zi表达式  在具体计算Zi值后做判断   加一个极小的量


